<body>
  <input id="todoInput" type="text" placeholder="Neue Aufgabe..." />
  <ul id="todoList"></ul>

  <div id="jointVisual" style="margin-top:20px;">
    <img id="jointImage" src="" style="max-width: 300px; display:none;" />
  </div>

  <script>
    const input = document.getElementById('todoInput');
    const list = document.getElementById('todoList');
    const jointImage = document.getElementById('jointImage');

    const todos = JSON.parse(localStorage.getItem('todos')) || [];

    function saveTodos() {
      const todoArray = [];
      list.querySelectorAll('li').forEach(li => {
        todoArray.push({
          text: li.querySelector('span').textContent,
          done: li.classList.contains('done')
        });
      });
      localStorage.setItem('todos', JSON.stringify(todoArray));
      updateJointVisual();
    }

    function addTodo(text, done = false) {
      const li = document.createElement('li');
      const span = document.createElement('span');
      span.textContent = text;
      li.appendChild(span);

      const btn = document.createElement('button');
      btn.textContent = 'x';
      btn.onclick = (e) => {
        e.stopPropagation();
        li.remove();
        saveTodos();
      };
      li.appendChild(btn);

      li.onclick = (e) => {
        if (e.target.tagName !== 'BUTTON') {
          li.classList.toggle('done');
          saveTodos();
        }
      };

      if (done) li.classList.add('done');
      list.appendChild(li);
    }

    todos.forEach(todo => addTodo(todo.text, todo.done));

    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && input.value.trim() !== '') {
        addTodo(input.value.trim());
        input.value = '';
        saveTodos();
      }
    });

    function updateJointVisual() {
      const doneCount = list.querySelectorAll('li.done').length;
      let step = Math.min(doneCount, 10); // Maximal Schritt 10
      if (step > 0) {
        jointImage.style.display = 'block';
        jointImage.src = `joint_step${step}.gif`;
      } else {
        jointImage.style.display = 'none';
      }
    }

    updateJointVisual();
  </script>
</body>
