<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wochenplaner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: white;
      color: black;
      transition: background-color 0.3s, color 0.3s;
      text-align: center;
    }
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    button {
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    button:hover {
      transform: scale(1.05);
    }

    .day:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .nav-buttons {
      display: flex;
      gap: 10px;
    }
    .nav-buttons button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background-color: white;
      color: black;
    }
    .nav-buttons button:hover {
      background-color: #f2f2f2;
    }
    #darkModeToggle, #settingsToggle {
      padding: 8px 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #333;
      color: white;
      cursor: pointer;
      margin-right: 10px;
    }

    body.dark-mode #darkModeToggle,
    body.dark-mode #settingsToggle {
      background-color: #2a2a2a;
    }

    .form-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-top: 15px;
    }

    .action-buttons {
      padding: 8px 12px;
      font-size: 18px;
      background: transparent;
      border: none;
      color: #333;
      cursor: pointer;
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    body.dark-mode .action-buttons button {
      color: #ddd;
    }

    .checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
      justify-content: center;
      text-align: center;
    }
    .checkboxes::before {
      content: "Tage ausw√§hlen:";
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .week {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }

    .day {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 100%;
      max-width: 250px;
      background: #f9f9f9;
    }
    body.dark-mode .day {
      background: #1e1e1e;
    }

    .feedback {
      margin: 10px auto;
      text-align: center;
      padding: 10px 15px;
      max-width: 400px;
      border-radius: 6px;
      font-size: 14px;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    .feedback.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .feedback.success {
      background-color: #d4edda;
      color: #155724;
    }
    .feedback.error {
      background-color: #f8d7da;
      color: #721c24;
    }

    .settings-panel {
      background: #f0f0f0;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      max-width: 400px;
      justify-content: center;
      text-align: center;
    }
    body.dark-mode .settings-panel {
      background: #2a2a2a;
      color: #eee;
    }
    .settings-panel label {
      display: block;
      margin: 5px 0;
    }
    #toggleDays label {
      display: inline-block;
      margin-right: 10px;
    }

    .priority-btn {
      background: none;
      border: none;
      color: goldenrod;
      font-size: 16px;
      cursor: pointer;
      margin-left: 8px;
    }
    li.priority {
      border-left: 4px solid goldenrod;
    }
    .task-text {
      flex-grow: 1;
      cursor: grab;
      transition: color 0.3s ease, opacity 0.3s ease;
    }
    li.done .task-text {
      text-decoration: line-through;
      color: gray;
      opacity: 0.6;
    }

    .top-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="top-block">
  <div class="header">
    <div style="display: flex; gap: 10px;">
      <button id="darkModeToggle">üåô</button>
      <button id="settingsToggle">‚öôÔ∏è</button>
    </div>
    <div class="nav-buttons">
      <button id="prevWeekBtn">&lt;</button>
      <button id="nextWeekBtn">&gt;</button>
    </div>
  </div>

  <h1>Mein Wochenplaner</h1>
  <div id="weekRange">Woche vom ...</div>
  <div id="feedback" class="feedback"></div>

  <div id="settingsPanel" class="settings-panel" style="display:none;">
    <h3>Einstellungen</h3>
    <label><input type="checkbox" id="toggleFavorites" checked> Favoriten aktivieren</label>
    <label><input type="checkbox" id="toggleBanner" checked> Mini-Benachrichtigungen anzeigen</label>
    <hr>
    <div id="toggleDays"></div>
  </div>

  <div class="form-container">
    <input type="text" id="taskInput" placeholder="Neue Aufgabe" required />
    <button id="addTaskBtn">‚ûï</button>
    <div class="action-buttons">
      <button id="undoBtn">‚Ü©Ô∏è</button>
      <button id="clearWeek">üóëÔ∏è</button>
    </div>
  </div>
  <div class="checkboxes" id="dayCheckboxes"></div>
</div>

<div class="week" id="week"></div>

<script>
const days = ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"];
const taskInput = document.getElementById("taskInput");
const weekRange = document.getElementById("weekRange");
const weekDiv = document.getElementById("week");
const checkboxesDiv = document.getElementById("dayCheckboxes");
const clearWeekBtn = document.getElementById("clearWeek");
let tasksByWeek = JSON.parse(localStorage.getItem("weeklyTasks")) || {};
let undoStack = [];
let weekOffset = 0;
let featureFlags = { favorites: true, banner: true };
let hiddenDays = new Set();

function getMondayOfWeek(offset = 0) {
  const today = new Date();
  const monday = new Date(today.setDate(today.getDate() - today.getDay() + 1 + offset * 7));
  monday.setHours(0, 0, 0, 0);
  return monday;
}
function formatDate(date) {
  return date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" });
}
function getWeekKey(monday) {
  return monday.toISOString().split("T")[0];
}
function saveTasks() {
  localStorage.setItem("weeklyTasks", JSON.stringify(tasksByWeek));
}
function showFeedback(message, type = "success") {
  if (!featureFlags.banner) return;
  const feedback = document.getElementById("feedback");
  feedback.textContent = message;
  feedback.className = `feedback ${type} show`;
  setTimeout(() => feedback.classList.remove("show"), 2500);
}
function createCheckboxes() {
  checkboxesDiv.innerHTML = "";
  days.forEach(day => {
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.value = day;
    label.appendChild(checkbox);
    label.append(day);
    checkboxesDiv.appendChild(label);
  });
}
function createDayToggles() {
  const toggleContainer = document.getElementById("toggleDays");
  toggleContainer.innerHTML = "<strong>Tage anzeigen:</strong><br>";
  days.forEach(day => {
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = !hiddenDays.has(day);
    checkbox.addEventListener("change", () => {
      checkbox.checked ? hiddenDays.delete(day) : hiddenDays.add(day);
      renderWeek();
    });
    label.appendChild(checkbox);
    label.append(day);
    toggleContainer.appendChild(label);
  });
}
function renderWeek() {
  const monday = getMondayOfWeek(weekOffset);
  const sunday = new Date(monday);
  sunday.setDate(monday.getDate() + 6);
  const weekKey = getWeekKey(monday);
  if (!tasksByWeek[weekKey]) tasksByWeek[weekKey] = {};
  const weekTasks = tasksByWeek[weekKey];
  weekRange.textContent = `Woche: ${formatDate(monday)} ‚Äì ${formatDate(sunday)}`;
  weekDiv.innerHTML = "";
  createDayToggles();
  days.forEach(day => {
    if (hiddenDays.has(day)) return;
    const date = new Date(monday);
    date.setDate(monday.getDate() + days.indexOf(day));
    const dateStr = formatDate(date);
    const dayTasks = weekTasks[day] || [];

    const dayDiv = document.createElement("div");
    dayDiv.className = "day";
    const dateEl = document.createElement("h2");
    dateEl.textContent = dateStr;
    const title = document.createElement("h3");
    title.textContent = day;
    const ul = document.createElement("ul");

    ul.ondragover = e => e.preventDefault();
    ul.ondrop = e => {
      e.preventDefault();
      const data = JSON.parse(e.dataTransfer.getData("text/plain"));
      const draggedTask = tasksByWeek[data.weekKey][data.day].splice(data.index, 1)[0];
      dayTasks.push(draggedTask);
      saveTasks();
      renderWeek();
    };

    dayTasks.forEach((task, index) => {
      const li = document.createElement("li");
      const taskText = document.createElement("span");
      taskText.className = "task-text";
      taskText.textContent = task.text;
      taskText.setAttribute("draggable", true);
      taskText.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", JSON.stringify({ weekKey, day, index }));
        taskText.style.opacity = "0.5";
      });
      taskText.addEventListener("dragend", () => {
        taskText.style.opacity = "1";
      });
      if (task.done) li.classList.add("done");
      taskText.addEventListener("click", () => {
        task.done = !task.done;
        saveTasks();
        renderWeek();
      });

      li.appendChild(taskText);

      if (featureFlags.favorites) {
        const starBtn = document.createElement("button");
        starBtn.innerHTML = task.priority ? "‚≠ê" : "‚òÜ";
        starBtn.className = "priority-btn";
        starBtn.addEventListener("click", e => {
          e.stopPropagation();
          task.priority = !task.priority;
          saveTasks();
          renderWeek();
        });
        if (task.priority) li.classList.add("priority");
        li.appendChild(starBtn);
      }

      const delBtn = document.createElement("button");
      delBtn.textContent = "√ó";
      delBtn.className = "delete-btn";
      delBtn.addEventListener("click", e => {
        e.stopPropagation();
        dayTasks.splice(index, 1);
        weekTasks[day] = dayTasks;
        saveTasks();
        renderWeek();
      });
      li.appendChild(delBtn);
      ul.appendChild(li);
    });

    dayDiv.appendChild(dateEl);
    dayDiv.appendChild(title);
    dayDiv.appendChild(ul);
    weekDiv.appendChild(dayDiv);
  });
}
function addTaskFromInput() {
  const text = taskInput.value.trim();
  const selectedDays = Array.from(checkboxesDiv.querySelectorAll("input:checked")).map(cb => cb.value);
  if (!text || selectedDays.length === 0) {
    showFeedback("Text und mindestens ein Tag erforderlich", "error");
    return;
  }
  const monday = getMondayOfWeek(weekOffset);
  const weekKey = getWeekKey(monday);
  const weekTasks = tasksByWeek[weekKey] || {};

  selectedDays.forEach(day => {
    const task = { text, done: false };
    if (!weekTasks[day]) weekTasks[day] = [];
    weekTasks[day].push(task);
    undoStack.push({ weekKey, day, index: weekTasks[day].length - 1 });
  });

  tasksByWeek[weekKey] = weekTasks;
  saveTasks();
  renderWeek();
  taskInput.value = "";
  checkboxesDiv.querySelectorAll("input").forEach(cb => cb.checked = false);
  showFeedback("Aufgabe hinzugef√ºgt ‚úÖ", "success");
}

document.getElementById("addTaskBtn").addEventListener("click", addTaskFromInput);
taskInput.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    addTaskFromInput();
  }
});
document.getElementById("undoBtn").addEventListener("click", () => {
  if (undoStack.length > 0) {
    const { weekKey, day, index } = undoStack.pop();
    const tasks = tasksByWeek[weekKey]?.[day];
    if (tasks && tasks.length > index) {
      tasks.splice(index, 1);
      saveTasks();
      renderWeek();
    }
  } else {
    showFeedback("Nichts zum R√ºckg√§ngig machen", "error");
  }
});
document.getElementById("clearWeek").addEventListener("click", () => {
  const monday = getMondayOfWeek(weekOffset);
  const weekKey = getWeekKey(monday);
  tasksByWeek[weekKey] = {};
  saveTasks();
  renderWeek();
});
document.getElementById("prevWeekBtn").addEventListener("click", () => {
  weekOffset--;
  renderWeek();
});
document.getElementById("nextWeekBtn").addEventListener("click", () => {
  weekOffset++;
  renderWeek();
});
document.getElementById("darkModeToggle").addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
  document.getElementById("darkModeToggle").textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
});
document.getElementById("settingsToggle").addEventListener("click", () => {
  const panel = document.getElementById("settingsPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
});
document.getElementById("toggleFavorites").addEventListener("change", e => {
  featureFlags.favorites = e.target.checked;
  renderWeek();
});
document.getElementById("toggleBanner").addEventListener("change", e => {
  featureFlags.banner = e.target.checked;
});

createCheckboxes();
renderWeek();
</script>
</body>
</html>
